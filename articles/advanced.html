<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced validation • shinyvalidate</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Advanced validation">
<meta property="og:description" content="shinyvalidate">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">shinyvalidate</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/shinyvalidate.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/advanced.html">Advanced validation</a>
    </li>
    <li>
      <a href="../articles/displaying.html">Displaying validation errors</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rstudio/shinyvalidate/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="advanced_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="advanced_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="advanced_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Advanced validation</h1>
                        <h4 class="author">Joe Cheng</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rstudio/shinyvalidate/blob/master/vignettes/advanced.Rmd"><code>vignettes/advanced.Rmd</code></a></small>
      <div class="hidden name"><code>advanced.Rmd</code></div>

    </div>

    
    
<p>The <a href="shinyvalidate.html">Introduction to shinyvalidate</a> only talks about creating a single <code>InputValidator</code> object per app<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. That may suffice for simpler apps, but more complex apps have multiple reasons for wanting to create multiple input validators.</p>
<p>This article discusses some of those more advanced use cases. But first, we need to introduce a couple of <code>InputValidator</code> features that support these advanced uses.</p>
<div id="advanced-inputvalidator-features" class="section level2">
<h2 class="hasAnchor">
<a href="#advanced-inputvalidator-features" class="anchor"></a>Advanced InputValidator features</h2>
<div id="child-validators" class="section level3">
<h3 class="hasAnchor">
<a href="#child-validators" class="anchor"></a>Child validators</h3>
<p>Hopefully you know by now that you can add rules to <code>InputValidator</code> objects, via the <code>add_rule()</code> method. What you may not know is that you can also add entire <code>InputValidator</code> objects to each other.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="va">parent_iv</span><span class="op">$</span><span class="fu">add_validator</span><span class="op">(</span><span class="va">child_iv</span><span class="op">)</span></pre></div>
<p>Each <code>InputValidator</code> object can have any number of child <code>InputValidator</code> objects. It’s also fine for a child <code>InputValidator</code> object to have children of its own.</p>
<p>If <code>child_iv$is_valid()</code> returns <code>FALSE</code>, then <code>parent_iv$is_valid()</code> will also return <code>FALSE</code>—in other words, an input validator is only valid if all of its child validators are valid. And when <code>parent_iv$enable()</code> is called, real-time validation feedback is enabled not only for its own rules, but for the rules of the child validators, and their children, and so on.</p>
<p>I’m not sure, however, it makes sense for one <code>InputValidator</code> object to be added as a child to two different parents. Currently, {shinyvalidate} doesn’t stop you from doing this, but I can’t be sure there aren’t strange edge cases that might emerge from doing so.</p>
</div>
<div id="conditional-validation" class="section level3">
<h3 class="hasAnchor">
<a href="#conditional-validation" class="anchor"></a>Conditional validation</h3>
<p>Another feature we’ll need is the ability to temporarily turn validation rules on and off, depending on some reactive input or state. We’ll see below where this comes in handy; for right now I’ll just describe how the feature works.</p>
<p>The <code>InputValidator</code> object has a <code>condition</code> method for this purpose: pass it either a formula or a zero-argument function that returns <code>TRUE</code> when the validation rules should be observed, and <code>FALSE</code> when they should be suspended.</p>
<p>Here are three equivalent ways to apply the <code><a href="https://rdrr.io/r/base/Logic.html">isTRUE(input$filter_by_date)</a></code> condition to <code>iv</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="co"># As formula</span>
<span class="va">iv</span><span class="op">$</span><span class="fu">condition</span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">filter_by_date</span><span class="op">)</span><span class="op">)</span>

<span class="co"># As anonymous function</span>
<span class="va">iv</span><span class="op">$</span><span class="fu">condition</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">filter_by_date</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span>

<span class="co"># As named function--or in this case, named reactive expression</span>
<span class="va">filtering_by_date</span> <span class="op">&lt;-</span> <span class="fu">reactive</span><span class="op">(</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">filter_by_date</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="va">iv</span><span class="op">$</span><span class="fu">condition</span><span class="op">(</span><span class="va">filtering_by_date</span><span class="op">)</span></pre></div>
<p>The effect of all three variants is the same: if <code>input$filter_by_date</code> is <code>TRUE</code>, then <code>iv</code> will function as normal. But if <code>input$filter_by_date</code> is not <code>TRUE</code>, then <code>iv</code> acts as if all of its rules are passing.</p>
<p>Note that I said “as if all of its rules are passing”, not “as if it has no rules” or “as if <code>iv</code> doesn’t even exist”. If a validator is enabled and has failing rules, there will be validation errors displayed to the user. If the <code>condition</code> then becomes <code>FALSE</code>, <em>these errors will be dismissed</em>. This is why “as if all of its rules are passing” matters; the validator doesn’t just stop validating, it dismisses existing errors for inputs that it has rules for.</p>
<p>To be clear, it’s <em>not</em> the case that you call the <code><a href="https://rdrr.io/r/base/conditions.html">condition()</a></code> method when you want to start or stop bypassing the validator’s rules. Rather, you call the <code><a href="https://rdrr.io/r/base/conditions.html">condition()</a></code> method just once per <code>InputValidator</code>, passing it <em>the logic that determines</em> whether the rules should be in effect or not, and trust that Shiny and {shinyvalidate} will invoke that logic as often as is necessary.</p>
</div>
</div>
<div id="advanced-validation-scenarios" class="section level2">
<h2 class="hasAnchor">
<a href="#advanced-validation-scenarios" class="anchor"></a>Advanced validation scenarios</h2>
<p>Now that we’ve covered these two new features, we can start discussing some more advanced use cases where multiple <code>InputValidator</code> objects are needed.</p>
<div id="multiple-independent-forms" class="section level3">
<h3 class="hasAnchor">
<a href="#multiple-independent-forms" class="anchor"></a>Multiple independent forms</h3>
<p>Some Shiny apps may have more than one totally independent form, that just happen to be rendered within the same app. In these cases, you don’t want to let validation errors in Form A prevent you from being able to submit Form B.</p>
<p>The solution to this is straightforward: create a separate <code>InputValidator</code> for each set of related inputs, making sure to use a different variable name for each. By convention, these variables should be suffixed with <code>_iv</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="va">signup_iv</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/InputValidator.html">InputValidator</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="va">signup_iv</span><span class="op">$</span><span class="fu">add_rule</span><span class="op">(</span><span class="st">"email"</span>, <span class="fu"><a href="../reference/sv_required.html">sv_required</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">recalculate_iv</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/InputValidator.html">InputValidator</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="va">recalculate_iv</span><span class="op">$</span><span class="fu">add_rule</span><span class="op">(</span><span class="st">"sample_count"</span>, <span class="fu"><a href="../reference/sv_numeric.html">sv_integer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">recalculate_iv</span><span class="op">$</span><span class="fu">add_rule</span><span class="op">(</span><span class="st">"sample_count"</span>, <span class="op">~</span> <span class="kw">if</span> <span class="op">(</span><span class="va">.</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span> <span class="st">"Must be positive"</span><span class="op">)</span></pre></div>
<p>[source, live demo] TODO</p>
<p>Now, reactives relating to signup can use <code>signup_iv</code>, and reactives relating to recalculation can use <code>recalculate_iv</code>. These two validator objects have no parent/child relationship; they’re just two independent objects that have nothing in common besides existing in the same environment.</p>
<p>Note that two independent validators may not have any overlap in the sets of inputs that they validate. In other words, since <code>signup_iv$add_rule("email", ...)</code> has been called, you cannot then do <code>recalculate_iv$add_rule("email", ...)</code>, since that could leave the validators with conflicting opinions about whether the <code>email</code> input is valid.</p>
</div>
<div id="conditional-subforms" class="section level3">
<h3 class="hasAnchor">
<a href="#conditional-subforms" class="anchor"></a>Conditional subforms</h3>
<p>Some apps need different subsets of their validation rules to be active at different times, depending on actions that the user takes. Consider this UI, that asks the user to choose between several ways of providing a profile picture: taking a webcam picture, uploading an image file, or looking up a <a href="https://gravatar.com">Gravatar</a> by email address.</p>
<p>[screencast]</p>
<p>[source, live demo] TODO</p>
<p>The Gravatar email address input is <code><a href="../reference/sv_required.html">sv_required()</a></code>, because we don’t want to let users submit the Gravatar option without it. But if the user has “Take selfie” currently selected, then the Gravatar email address is not relevant, and the validation rule should be ignored.</p>
<p>We can achieve this by breaking our validation rules into groups using child validators, and then attaching the appropriate conditional to each child validator.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="va">gravatar_iv</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/InputValidator.html">InputValidator</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="va">gravatar_iv</span><span class="op">$</span><span class="fu">condition</span><span class="op">(</span><span class="op">~</span> <span class="va">input</span><span class="op">$</span><span class="va">mode</span> <span class="op">==</span> <span class="st">"gravatar"</span><span class="op">)</span>
<span class="va">gravatar_iv</span><span class="op">$</span><span class="fu">add_rule</span><span class="op">(</span><span class="st">"email"</span>, <span class="fu"><a href="../reference/sv_required.html">sv_required</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>;</pre></div>
<p>Unlike the scenario described above in <a href="#multiple-independent-forms">Multiple independent forms</a>, the individual validator objects associated with each mode–<code>selfie_iv</code>, <code>upload_iv</code>, and <code>gravatar_iv</code>–do not represent independent forms; rather, they all are tied to the same Submit button. We handle this by introducing one more <code>InputValidator</code> object, this time representing the overall form, and adding our three validator objects to it as children.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="va">iv</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/InputValidator.html">InputValidator</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="va">iv</span><span class="op">$</span><span class="fu">add_validator</span><span class="op">(</span><span class="va">selfie_iv</span><span class="op">)</span>
<span class="va">iv</span><span class="op">$</span><span class="fu">add_validator</span><span class="op">(</span><span class="va">upload_iv</span><span class="op">)</span>
<span class="va">iv</span><span class="op">$</span><span class="fu">add_validator</span><span class="op">(</span><span class="va">gravatar_iv</span><span class="op">)</span></pre></div>
</div>
<div id="validating-shiny-modules" class="section level3">
<h3 class="hasAnchor">
<a href="#validating-shiny-modules" class="anchor"></a>Validating Shiny modules</h3>
<p>{shinyvalidate} is designed to work with <a href="https://shiny.rstudio.com/articles/modules.html">Shiny modules</a>.</p>
<p>Shiny modules provide a way to break up the logic of a Shiny app into smaller, more modular pieces that can each be reasoned about independently. That is the same job of regular R functions, but Shiny modules distinguish themselves versus regular R functions by providing namespacing for Shiny input and output IDs.</p>
<p>For example, in a module server function executing with an <code>id</code> (i.e., namespace) of <code>"one"</code>, the expression <code>input$x</code> is actually equivalent to an outside-the-module expression of <code>input$`one-x`</code>.</p>
<p>Similarly, when <code>iv$add_rule("x", ...)</code> is called, the environment is checked to see if we’re currently in a Shiny module server function; if so, then the ID <code>"x"</code> is treated as being in the current namespace (<code>"one-x"</code>). In other words, <code>iv$add_rule()</code> is namespace-aware.</p>
<p>Note that this namespace resolution is <em>not</em> performed when the input validator object itself is created, but rather, whenever a rule is added. This allows a single input validator object to collect rules across multiple modules.</p>
<p>This gives us a lot of flexibility as we try to figure out how to combine input validators with modules—so much so, in fact, that it’s too early at the time of this writing to clearly identify “best practices”. Consider the following to be merely guidelines, and please file <a href="https://github.com/rstudio/shinyvalidate/issues">GitHub issues</a> as you encounter limitations of the various approaches.</p>
<div id="self-contained-validation" class="section level4">
<h4 class="hasAnchor">
<a href="#self-contained-validation" class="anchor"></a>Self-contained validation</h4>
<p>Imagine a Shiny module that contains an entire form, submission button and all. The module’s inputs need to be validated and display feedback, and the module’s reactives and outputs need to check <code>is_valid()</code>. Code <em>outside</em> the module, however, doesn’t need to influence the validation in any way, nor query <code>is_valid()</code>.</p>
<p>In this case, the module server function can create its own local <code>InputValidator</code> object and use it internally.</p>
<p>[TODO: example?]</p>
</div>
<div id="module-as-sub-form" class="section level4">
<h4 class="hasAnchor">
<a href="#module-as-sub-form" class="anchor"></a>Module as sub-form</h4>
<p>Other Shiny modules may have a more transparent relationship with a surrounding form. Consider a Shiny module representing a single input, that returns the value of that input to the caller. It’s reasonable to expect the Shiny module to know how to determine whether the user’s input is valid, but the module shouldn’t need to know anything about the <em>context</em> in which that validation happens. Should validation errors be shown right away, or deferred until a Submit button is pressed—and if so, what button is that? Are there downstream reactive expressions and observers that need to guard against invalid data? These kinds of questions need to be concerns of the caller of the module, not the caller itself.</p>
<p>What this means, concretely, is that a Shiny module that contains an input (or multiple inputs) that need to be consumed by the caller, should call <code>iv$add_rule()</code> for its own inputs but generally leave <code>iv$enable()</code> or <code>iv$condition()</code> to the caller.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="co"># Module UI</span>
<span class="va">email_ui</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span>, <span class="va">label</span> <span class="op">=</span> <span class="st">"Email"</span>, <span class="va">value</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">ns</span> <span class="op">&lt;-</span> <span class="fu">NS</span><span class="op">(</span><span class="va">id</span><span class="op">)</span>
  <span class="fu">textInput</span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"email_address"</span><span class="op">)</span>, label <span class="op">=</span> <span class="va">label</span>, value <span class="op">=</span> <span class="va">value</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Module server</span>
<span class="va">email</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span>, <span class="va">required</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">moduleServer</span><span class="op">(</span><span class="va">id</span>, <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
    
    <span class="co"># Create and populate InputValidator object</span>
    <span class="va">iv</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/InputValidator.html">InputValidator</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">required</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">iv</span><span class="op">$</span><span class="fu">add_rule</span><span class="op">(</span><span class="st">"email_address"</span>, <span class="fu"><a href="../reference/sv_required.html">sv_required</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="va">iv</span><span class="op">$</span><span class="fu">add_rule</span><span class="op">(</span><span class="st">"email_address"</span>, <span class="op">~</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu">is_valid_email</span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="st">"Invalid email address"</span><span class="op">)</span>

    <span class="co"># Allow caller to reset the input</span>
    <span class="va">reset</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu">updateTextInput</span><span class="op">(</span><span class="va">session</span>, <span class="st">"email_address"</span>, value <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
    <span class="op">}</span>

    <span class="co"># Return value accessor, InputValidator, and reset function to the caller</span>
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      value <span class="op">=</span> <span class="fu">reactive</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">email_address</span><span class="op">)</span>,
      iv <span class="op">=</span> <span class="va">iv</span>,
      reset <span class="op">=</span> <span class="va">reset</span>
    <span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># App UI</span>
<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span>
  <span class="fu">email_ui</span><span class="op">(</span><span class="st">"email"</span>, <span class="st">"Email address"</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># App server</span>
<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">email_result</span> <span class="op">&lt;-</span> <span class="fu">email</span><span class="op">(</span><span class="st">"email"</span><span class="op">)</span>
  <span class="va">email_result</span><span class="op">$</span><span class="va">iv</span><span class="op">$</span><span class="fu">enable</span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span></pre></div>
<p>[TODO: source code, live demo - 04_module_1]</p>
</div>
<div id="caller-provided-validation-rules-for-module-inputs" class="section level4">
<h4 class="hasAnchor">
<a href="#caller-provided-validation-rules-for-module-inputs" class="anchor"></a>Caller-provided validation rules for module inputs</h4>
<p>In the previous section, we assumed that a Shiny module knows everything there is to know about its own inputs’ validation rules. What if the module wants the caller to help decide if an input is valid?</p>
<p>Let’s consider a <code>password_input</code> Shiny module that provides the UI and logic for this kind of subform, the kind you’ve filled out a hundred times online:</p>
<p>[screenshot: two password fields]</p>
<p>This Shiny module can and should include validation rules to ensure that the “Password” and “Password (confirm)” fields always match. But there are other possible validation rules that might or might not be important for any particular app: Is there a minimum/maximum password length? Are passwords required to contain at least one number, uppercase letter, and/or special character? What special characters are allowed? These all feel like the responsibility of the module <em>caller</em> to decide, not the module <em>implementation</em>.</p>
<p>One bad but obvious way to do it would be for the caller to add its own rules directly to the <code>InputValidator</code> object returned by <code>password_input</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">password_result</span> <span class="op">&lt;-</span> <span class="fu">password_input</span><span class="op">(</span><span class="st">"password"</span><span class="op">)</span>

  <span class="co"># Adding a rule for one of password_input's inputs, from outside</span>
  <span class="co"># of password_input. DON'T DO THIS!</span>
  <span class="va">password_result</span><span class="op">$</span><span class="va">iv</span><span class="op">$</span><span class="fu">add_rule</span><span class="op">(</span><span class="fu">NS</span><span class="op">(</span><span class="st">"password"</span>, <span class="st">"pw1"</span><span class="op">)</span>, <span class="op">~</span> <span class="op">{</span>
    <span class="co"># Custom validation logic</span>
    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"[0-9]"</span>, <span class="va">pw</span><span class="op">)</span> <span class="op">||</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"[A-Z]"</span>, <span class="va">pw</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
      <span class="st">"Must include a number and an upper-case character"</span>
    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">pw</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">8</span><span class="op">)</span> <span class="op">{</span>
      <span class="st">"Must be at least 8 characters"</span>
    <span class="op">}</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span></pre></div>
<p>The reason this is bad is because it requires the caller to know the input IDs used within the module (<code>NS("password", "pw1")</code> in this case). This violates a module boundary that we should try hard to keep sacred!</p>
<p>Instead, the module should take a validation rule—i.e., the second argument to <code>add_rule</code>—as a parameter. (If multiple inputs need to be validated, then one such parameter should be created for each input.)</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="va">password_input</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span>, <span class="va">password_rule</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">moduleServer</span><span class="op">(</span><span class="va">id</span>, <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">iv</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/InputValidator.html">InputValidator</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
    <span class="va">iv</span><span class="op">$</span><span class="fu">add_rule</span><span class="op">(</span><span class="st">"pw2"</span>, <span class="op">~</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">input</span><span class="op">$</span><span class="va">pw1</span><span class="op">)</span><span class="op">)</span> <span class="st">"Passwords do not match"</span><span class="op">)</span>
    
    <span class="co"># Add custom rule passed in by caller</span>
    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">password_rule</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">iv</span><span class="op">$</span><span class="fu">add_rule</span><span class="op">(</span><span class="st">"pw1"</span>, <span class="va">password_rule</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Initialize the module, passing custom validation logic via password_rule</span>
  <span class="va">password_result</span> <span class="op">&lt;-</span> <span class="fu">password_input</span><span class="op">(</span><span class="st">"password"</span>, password_rule <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">pw</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"[0-9]"</span>, <span class="va">pw</span><span class="op">)</span> <span class="op">||</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"[A-Z]"</span>, <span class="va">pw</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
      <span class="st">"Must include a number and an upper-case character"</span>
    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">pw</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">8</span><span class="op">)</span> <span class="op">{</span>
      <span class="st">"Must be at least 8 characters"</span>
    <span class="op">}</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span></pre></div>
<p>[TODO: source link, live demo - 05_module_2]</p>
</div>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>To be precise, it’s actually one <code>InputValidator</code> object per session, not per app.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Joe Cheng,  RStudio.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
